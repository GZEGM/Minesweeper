<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tr√≤ Ch∆°i D√≤ M√¨n N√¢ng Cao</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap");
      body {
        font-family: "Inter", sans-serif;
        background-color: #f0f4f8;
        display: flex;
        justify-content: center;
        align-items: flex-start;
        min-height: 100vh;
        padding: 16px;
      }
      .main-content {
        max-width: 90vw;
        width: 450px;
        background-color: #ffffff;
        box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1),
          0 0 10px -5px rgba(0, 0, 0, 0.04);
        border-radius: 12px;
        padding: 20px;
        transition: width 0.3s ease-in-out, max-width 0.3s ease-in-out;
      }
      #gameBoard,
      #spectatorBoard {
        display: grid;
        border: 4px solid #ccd5ae;
        box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.1);
        touch-action: none;
      }
      .cell {
        width: 100%;
        height: 0;
        padding-bottom: 100%;
        position: relative;
        background-color: #e9edc9;
        border: 1px solid #ccd5ae;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 1.2rem;
        font-weight: 700;
        cursor: pointer;
        user-select: none;
        transition: background-color 0.1s, transform 0.1s;
      }
      .cell-content {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
      }
      .cell:hover:not(.revealed):not(.flagged) {
        background-color: #d4d7a8;
      }
      .revealed {
        background-color: #feffe0;
        border: 1px solid #d4d7a8;
        cursor: default;
      }
      .c1 {
        color: #0000ff;
      }
      .c2 {
        color: #008000;
      }
      .c3 {
        color: #ff0000;
      }
      .c4 {
        color: #000080;
      }
      .c5 {
        color: #800000;
      }
      .c6 {
        color: #008080;
      }
      .c7 {
        color: #000000;
      }
      .c8 {
        color: #808080;
      }
      .mine {
        background-color: #ffcccc !important;
      }
      .mine-hit {
        background-color: #ff4d4d !important;
        animation: explode 0.5s ease-out;
        transform: scale(1.2);
        z-index: 10;
        border-radius: 50%;
      }
      .mine .cell-content,
      .mine-hit .cell-content {
        font-size: 1.5rem;
      }
      .flagged {
        color: #ff3838;
        background-color: #f7e6e6;
      }
      .auto-flagged {
        color: #1e40af;
      }
      .cell:active:not(.revealed):not(.flagged) {
        transform: scale(0.95);
      }
      .board-shake {
        animation: shake 0.5s cubic-bezier(0.36, 0.07, 0.19, 0.97) both;
      }
      @keyframes shake {
        10%,
        90% {
          transform: translate3d(-1px, 0, 0);
        }
        20%,
        80% {
          transform: translate3d(2px, 0, 0);
        }
        30%,
        50%,
        70% {
          transform: translate3d(-4px, 0, 0);
        }
        40%,
        60% {
          transform: translate3d(4px, 0, 0);
        }
      }
      @keyframes explode {
        0% {
          transform: scale(0.5);
          opacity: 0;
        }
        50% {
          transform: scale(1.2);
          opacity: 1;
        }
        100% {
          transform: scale(1);
        }
      }
      .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.6);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 1000;
        backdrop-filter: blur(4px);
      }
      .modal-content {
        background: white;
        padding: 24px;
        border-radius: 12px;
        max-width: 90%;
        width: 450px;
        box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
        max-height: 80vh;
        overflow-y: auto;
        position: relative;
        animation: slide-up 0.3s ease-out;
      }
      @keyframes slide-up {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      .helper-icon-button {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        transition: all 0.2s;
        color: white;
        font-weight: bold;
        line-height: 1;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }
      .helper-icon-button:hover:not(:disabled) {
        transform: scale(1.05);
        box-shadow: 0 8px 15px rgba(0, 0, 0, 0.2);
      }
      .helper-icon-button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }
      .helper-icon-count {
        font-size: 0.75rem;
        margin-top: 2px;
        background: rgba(0, 0, 0, 0.2);
        padding: 1px 6px;
        border-radius: 9999px;
      }
      .shield-active {
        box-shadow: 0 0 15px 5px #3498db, inset 0 0 10px #3498db;
      }
      .scanner-active {
        cursor: crosshair;
      }
      .scanned-cell {
        animation: scan-pulse 0.7s;
      }
      @keyframes scan-pulse {
        0% {
          background-color: rgba(255, 255, 0, 0.5);
        }
        100% {
          background-color: transparent;
        }
      }
      .close-button {
        position: absolute;
        top: 10px;
        right: 10px;
        width: 32px;
        height: 32px;
        background-color: #f3f4f6;
        border-radius: 50%;
        border: none;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 20px;
        color: #6b7280;
        transition: background-color 0.2s, transform 0.2s;
      }
      .close-button:hover {
        background-color: #e5e7eb;
        transform: rotate(90deg);
      }
      .chat-message {
        padding: 4px 8px;
        border-radius: 8px;
        margin-bottom: 4px;
        max-width: 85%;
        word-wrap: break-word;
      }
      .chat-message.me {
        background-color: #dbeafe;
        align-self: flex-end;
      }
      .chat-message.other {
        background-color: #e5e7eb;
        align-self: flex-start;
      }
    </style>
  </head>
  <body oncontextmenu="return false;">
    <div class="main-content">
      <!-- Main Menu View -->
      <div id="mainMenuView">
        <h1 class="text-3xl font-extrabold text-center text-gray-800 mb-2">
          üí£ Ch√†o M·ª´ng ƒê·∫øn D√≤ M√¨n üö©
        </h1>
        <p class="text-center text-gray-600 mb-4">
          Ng∆∞·ªùi ch∆°i:
          <span id="playerNameDisplay" class="font-bold text-indigo-600"
            >...</span
          >
        </p>

        <!-- Resume Game Prompt -->
        <div
          id="resumeGamePrompt"
          class="hidden p-4 mb-4 bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 rounded-lg"
        >
          <h3 class="font-bold">T√¨m th·∫•y v√°n ch∆°i ƒë∆°n!</h3>
          <p>B·∫°n c√≥ mu·ªën ti·∫øp t·ª•c v√°n ch∆°i tr∆∞·ªõc kh√¥ng?</p>
          <div class="mt-3 flex gap-3">
            <button
              id="resumeGameBtn"
              class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded"
            >
              Ti·∫øp T·ª•c
            </button>
            <button
              id="discardGameBtn"
              class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded"
            >
              B·ªè Qua
            </button>
          </div>
        </div>

        <div class="grid grid-cols-2 gap-3 mb-4">
          <button
            id="playWithBotMenuButton"
            class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-2 rounded-lg transition duration-200 transform hover:scale-[1.01] shadow-md shadow-green-300"
          >
            ü§ñ Ch∆°i V·ªõi M√°y
          </button>
          <button
            id="matchmakingMenuButton"
            class="w-full bg-red-500 hover:bg-red-600 text-white font-bold py-3 px-2 rounded-lg transition duration-200 transform hover:scale-[1.01] shadow-md shadow-red-300"
          >
            ‚öîÔ∏è Gh√©p Tr·∫≠n
          </button>
          <button
            id="multiplayerMenuButton"
            class="w-full bg-purple-500 hover:bg-purple-600 text-white font-bold py-3 px-2 rounded-lg transition duration-200 transform hover:scale-[1.01] shadow-md shadow-purple-300"
          >
            üë• T·∫°o Ph√≤ng
          </button>
          <button
            id="customMapMenuButton"
            class="w-full bg-orange-500 hover:bg-orange-600 text-white font-bold py-3 px-2 rounded-lg transition duration-200 transform hover:scale-[1.01] shadow-md shadow-orange-300"
          >
            ‚öôÔ∏è Map T√πy Ch·ªânh
          </button>
        </div>

        <h2 class="text-xl font-bold text-center text-gray-700 my-4">
          Ch·ªçn C·∫•p ƒê·ªô (Ch∆°i ƒê∆°n)
        </h2>
        <div
          id="mapSelection"
          class="grid grid-cols-1 md:grid-cols-2 gap-3"
        ></div>
        <div class="grid grid-cols-2 gap-3 mt-4">
          <button
            id="leaderboardMenuButton"
            class="w-full bg-teal-500 hover:bg-teal-600 text-white font-bold py-3 rounded-lg transition duration-200 transform hover:scale-[1.01] shadow-md shadow-teal-300"
          >
            üèÜ B·∫£ng X·∫øp H·∫°ng
          </button>
          <button
            id="historyMenuButton"
            class="w-full bg-cyan-500 hover:bg-cyan-600 text-white font-bold py-3 rounded-lg transition duration-200 transform hover:scale-[1.01] shadow-md shadow-cyan-300"
          >
            üìú L·ªãch S·ª≠ ƒê·∫•u
          </button>
        </div>
      </div>

      <!-- Play With Bot View -->
      <div id="playWithBotView" class="hidden">
        <h2 class="text-2xl font-bold text-gray-800 mb-4">ü§ñ Ch∆°i V·ªõi M√°y</h2>
        <div class="space-y-4">
          <div>
            <label
              for="botDifficultySelect"
              class="block font-medium text-gray-700"
              >Ch·ªçn ƒë·ªô kh√≥:</label
            >
            <select
              id="botDifficultySelect"
              class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md"
            >
              <option value="easy">D·ªÖ</option>
              <option value="medium">Trung B√¨nh</option>
              <option value="hard">Kh√≥</option>
              <option value="master">B·∫≠c Th·∫ßy</option>
            </select>
          </div>
          <div>
            <label for="botMapSelect" class="block font-medium text-gray-700"
              >Ch·ªçn Map:</label
            >
            <select
              id="botMapSelect"
              class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md"
            ></select>
          </div>
          <button
            id="startBotGameButton"
            class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-3 rounded-lg transition duration-200"
          >
            B·∫Øt ƒê·∫ßu Thi ƒê·∫•u
          </button>
        </div>
        <button
          class="mt-4 w-full bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 rounded-lg transition back-to-menu-button"
        >
          Quay L·∫°i Menu
        </button>
      </div>

      <!-- Matchmaking View -->
      <div id="matchmakingView" class="hidden">
        <h2 class="text-2xl font-bold text-gray-800 mb-4">‚öîÔ∏è Gh√©p Tr·∫≠n</h2>
        <p class="text-center text-gray-600 mb-4">
          Ch·ªçn s·ªë l∆∞·ª£ng ng∆∞·ªùi ch∆°i ƒë·ªÉ t√¨m ph√≤ng.
        </p>
        <div id="matchmakingOptions" class="space-y-3">
          <button
            data-players="2"
            class="find-match-button w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 rounded-lg"
          >
            2 Ng∆∞·ªùi
          </button>
          <button
            data-players="3"
            class="find-match-button w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 rounded-lg"
          >
            3 Ng∆∞·ªùi
          </button>
          <button
            data-players="4"
            class="find-match-button w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 rounded-lg"
          >
            4 Ng∆∞·ªùi
          </button>
        </div>
        <div
          id="matchmakingStatusContainer"
          class="hidden mt-4 text-center p-3 bg-gray-100 rounded"
        >
          <p id="matchmakingStatusText">ƒêang t√¨m tr·∫≠n...</p>
          <div class="w-full bg-gray-200 rounded-full h-2.5 mt-2">
            <div class="bg-blue-600 h-2.5 rounded-full animate-pulse"></div>
          </div>
        </div>
        <button
          id="cancelMatchmakingButton"
          class="hidden mt-3 w-full bg-red-500 hover:bg-red-600 text-white font-bold py-2 rounded-lg"
        >
          H·ªßy
        </button>
        <button
          class="mt-3 w-full bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 rounded-lg transition back-to-menu-button"
        >
          Quay L·∫°i Menu
        </button>
      </div>

      <!-- Game View -->
      <div id="gameView" class="hidden">
        <div
          class="flex justify-between items-center bg-gray-100 p-3 rounded-t-lg border-b border-gray-200 shadow-inner"
        >
          <div class="flex flex-col items-center">
            <div class="text-xs font-semibold text-red-500">M√¨n (üö©)</div>
            <div class="text-xl font-bold text-red-600 flex items-center">
              <span id="minesLeft" class="w-8 text-center">0</span>
            </div>
          </div>
          <div class="flex flex-col items-center">
            <div class="text-xs font-semibold text-blue-500">C·∫•p ƒê·ªô</div>
            <div id="mapName" class="text-lg font-bold text-blue-600"></div>
          </div>
          <div class="flex flex-col items-center">
            <div class="text-xs font-semibold text-green-500">
              Th·ªùi Gian (s)
            </div>
            <div class="text-xl font-bold text-green-600 flex items-center">
              <span id="timer" class="w-12 text-center">0</span>
            </div>
          </div>
        </div>
        <div
          id="botGameStatus"
          class="hidden p-2 bg-gray-800 text-white rounded-b-lg mb-4"
        >
          <div class="text-sm font-bold text-center mb-1">Thi ƒë·∫•u v·ªõi M√°y</div>
          <div class="flex justify-between items-center text-xs">
            <span>ü§ñ M√°y (<span id="botDifficultyDisplay"></span>)</span>
            <span id="botProgressText">0%</span>
          </div>
          <div class="w-full bg-gray-600 rounded-full h-2 mt-1">
            <div
              id="botProgressBar"
              class="bg-green-500 h-2 rounded-full transition-all duration-500"
              style="width: 0%"
            ></div>
          </div>
        </div>
        <div
          id="statusMessage"
          class="text-center font-bold text-gray-700 py-2 bg-yellow-50 rounded-b-lg mb-4"
        >
          S·∫µn s√†ng
        </div>
        <div id="multiplayerStatus" class="mb-4"></div>
        <div id="gameBoard" class="mb-4"></div>
        <div
          id="spectatorView"
          class="hidden text-center p-4 bg-gray-100 rounded-lg"
        >
          <h2 class="text-2xl font-bold text-green-600 mb-2">
            üèÜ B·∫°n ƒë√£ ho√†n th√†nh! üèÜ
          </h2>
          <p class="text-gray-700 mb-4">
            B·∫°n c√≥ th·ªÉ xem nh·ªØng ng∆∞·ªùi ch∆°i kh√°c ho·∫∑c quay l·∫°i.
          </p>
          <div
            id="spectatorControls"
            class="my-4 flex flex-col sm:flex-row items-center justify-center gap-3"
          >
            <div class="flex items-center gap-2">
              <label for="spectatorSelect" class="font-semibold"
                >Xem ng∆∞·ªùi ch∆°i:</label
              >
              <select id="spectatorSelect" class="border rounded p-2 bg-white">
                <option value="">-- Ch·ªçn --</option>
              </select>
            </div>
            <button
              id="spectatorExitButton"
              class="w-full sm:w-auto bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg transition duration-200"
            >
              Quay L·∫°i
            </button>
          </div>
          <div
            id="spectatorBoardWrapper"
            class="mt-4 flex justify-center"
          ></div>
          <div id="spectatorStatusContainer" class="mt-6"></div>
        </div>
        <div id="game-controls" class="grid grid-cols-2 gap-3 mb-3">
          <button
            id="resetButton"
            class="w-full bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-3 rounded-lg transition duration-200 transform hover:scale-[1.01] shadow-md shadow-indigo-300"
          >
            Ch∆°i L·∫°i
          </button>
          <button
            id="backToMenuButton"
            class="w-full bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 rounded-lg transition duration-200 transform hover:scale-[1.01] shadow-md shadow-gray-300"
          >
            Quay L·∫°i Menu
          </button>
        </div>
        <div id="extra-controls" class="grid grid-cols-2 gap-3 mb-3">
          <button
            id="guideButton"
            class="w-full bg-yellow-500 hover:bg-yellow-600 text-gray-800 font-bold py-3 rounded-lg transition duration-200 transform hover:scale-[1.01] shadow-md shadow-yellow-300"
          >
            üìö H∆∞·ªõng D·∫´n
          </button>
          <button
            id="leaderboardGameButton"
            class="w-full bg-teal-500 hover:bg-teal-600 text-white font-bold py-3 rounded-lg transition duration-200 transform hover:scale-[1.01] shadow-md shadow-teal-300"
          >
            üèÜ B·∫£ng X·∫øp H·∫°ng
          </button>
        </div>
        <div
          id="helpers-section"
          class="mt-4 p-4 bg-gray-100 rounded-lg shadow"
        >
          <div class="flex justify-between items-center mb-4">
            <h3 class="font-bold text-lg text-gray-700">üõ†Ô∏è Ph·ª• Tr·ª£</h3>
            <button
              id="commandMenuButton"
              class="bg-gray-600 hover:bg-gray-700 text-white font-bold p-2 rounded-full transition duration-200"
              title="M·ªü menu l·ªánh"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="20"
                height="20"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path d="m18 18-6-6 6-6" />
                <path d="m6 6 6 6-6 6" />
              </svg>
            </button>
          </div>
          <div class="flex justify-around space-x-2">
            <button
              id="xrayButton"
              class="helper-icon-button bg-green-500 hover:bg-green-600"
              title="Tia X"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z" />
                <circle cx="12" cy="12" r="3" />
              </svg>
              <span class="helper-icon-count" id="xrayCount">0</span>
            </button>
            <button
              id="autoFlagButton"
              class="helper-icon-button bg-blue-500 hover:bg-blue-600"
              title="C·ªù T·ª± ƒê·ªông"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path
                  d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"
                />
                <line x1="4" x2="4" y1="22" y2="15" />
              </svg>
              <span class="helper-icon-count" id="autoFlagCount">0</span>
            </button>
            <button
              id="surferButton"
              class="helper-icon-button bg-purple-500 hover:bg-purple-600"
              title="L∆∞·ªõt S√≥ng"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path d="M14.5 16.5a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5Z" />
                <path d="M6 22a2 2 0 1 0 0-4 2 2 0 0 0 0 4Z" />
                <path d="M12 12a1 1 0 1 0 0-2 1 1 0 0 0 0 2Z" />
                <path d="m19.5 12.5-4.4-2.2" />
                <path d="m6.2 13.1-2.9-1.3" />
                <path d="m14.2 7.2-.6-4.9" />
                <path d="m10.1 19.3-1.2-4.1" />
              </svg>
              <span class="helper-icon-count" id="surferCount">0</span>
            </button>
            <button
              id="shieldButton"
              class="helper-icon-button bg-cyan-500 hover:bg-cyan-600"
              title="Khi√™n"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" />
              </svg>
              <span class="helper-icon-count" id="shieldCount">0</span>
            </button>
            <button
              id="scannerButton"
              class="helper-icon-button bg-orange-500 hover:bg-orange-600"
              title="M√°y D√≤"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <circle cx="12" cy="12" r="10" />
                <circle cx="12" cy="12" r="6" />
                <circle cx="12" cy="12" r="2" />
              </svg>
              <span class="helper-icon-count" id="scannerCount">0</span>
            </button>
          </div>
        </div>
        <div
          id="personal-best-section"
          class="mt-4 p-3 bg-blue-50 rounded-lg shadow-inner"
        >
          <h3 class="font-bold text-lg text-blue-700 mb-2">
            Th√†nh T√≠ch C√° Nh√¢n
          </h3>
          <div class="flex justify-between text-sm text-gray-700 mt-2">
            <span class="font-semibold">Th·ªùi gian t·ªët nh·∫•t:</span>
            <span id="personalBestTime" class="font-bold text-lg text-blue-900"
              >--s</span
            >
          </div>
        </div>
        <!-- Game Chat Container -->
        <div id="multiplayerChatContainer" class="hidden mt-4">
          <h3 class="font-bold text-lg mb-2 text-gray-700">Chat Tr·∫≠n ƒê·∫•u</h3>
          <div
            id="gameChatMessages"
            class="h-24 overflow-y-auto border rounded p-2 bg-gray-50 mb-2 flex flex-col"
          ></div>
          <form id="gameChatForm" class="flex gap-2">
            <input
              type="text"
              id="gameChatInput"
              placeholder="Nh·∫≠p tin nh·∫Øn..."
              class="flex-grow border rounded p-2"
              autocomplete="off"
            />
            <button
              type="submit"
              class="bg-indigo-500 hover:bg-indigo-600 text-white font-bold p-2 rounded-lg"
            >
              G·ª≠i
            </button>
          </form>
        </div>
      </div>

      <!-- Custom Map View -->
      <div id="customMapView" class="hidden">
        <button id="closeCustomMapButton" class="close-button">&times;</button>
        <h2 class="text-2xl font-bold text-gray-800 mb-4">
          ‚öôÔ∏è T·∫°o Map T√πy Ch·ªânh
        </h2>
        <form id="customMapForm" class="space-y-4">
          <div>
            <label for="customRows" class="block font-medium"
              >S·ªë D√≤ng (3-300)</label
            >
            <input
              type="number"
              id="customRows"
              value="16"
              min="3"
              max="300"
              class="w-full border rounded p-2"
            />
          </div>
          <div>
            <label for="customCols" class="block font-medium"
              >S·ªë C·ªôt (3-300)</label
            >
            <input
              type="number"
              id="customCols"
              value="16"
              min="3"
              max="300"
              class="w-full border rounded p-2"
            />
          </div>
          <div>
            <label for="customMines" class="block font-medium">S·ªë M√¨n</label>
            <input
              type="number"
              id="customMines"
              value="40"
              min="1"
              class="w-full border rounded p-2"
            />
          </div>
          <h3 class="font-bold pt-2">S·ªë L∆∞·ª£ng Ph·ª• Tr·ª£</h3>
          <div class="grid grid-cols-2 gap-3">
            <div>
              <label for="customXray">Tia X</label>
              <input
                type="number"
                id="customXray"
                value="3"
                min="0"
                max="99"
                class="w-full border rounded p-1"
              />
            </div>
            <div>
              <label for="customAutoFlag">C·ªù T·ª± ƒê·ªông</label>
              <input
                type="number"
                id="customAutoFlag"
                value="3"
                min="0"
                max="99"
                class="w-full border rounded p-1"
              />
            </div>
            <div>
              <label for="customSurfer">L∆∞·ªõt S√≥ng</label>
              <input
                type="number"
                id="customSurfer"
                value="2"
                min="0"
                max="99"
                class="w-full border rounded p-1"
              />
            </div>
            <div>
              <label for="customShield">Khi√™n</label>
              <input
                type="number"
                id="customShield"
                value="2"
                min="0"
                max="99"
                class="w-full border rounded p-1"
              />
            </div>
            <div>
              <label for="customScanner">M√°y D√≤</label>
              <input
                type="number"
                id="customScanner"
                value="2"
                min="0"
                max="99"
                class="w-full border rounded p-1"
              />
            </div>
          </div>
          <button
            type="submit"
            class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-3 rounded-lg"
          >
            B·∫Øt ƒê·∫ßu Ch∆°i
          </button>
        </form>
        <button
          class="mt-3 w-full bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 rounded-lg transition back-to-menu-button"
        >
          Quay L·∫°i Menu
        </button>
      </div>

      <!-- Multiplayer Lobby Selection View -->
      <div id="multiplayerView" class="hidden">
        <h2 class="text-2xl font-bold text-gray-800 mb-6">
          üë• Ch∆°i Nhi·ªÅu Ng∆∞·ªùi
        </h2>
        <div class="space-y-4">
          <button
            id="hostGameButton"
            class="w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 rounded-lg text-lg"
          >
            T·∫°o Ph√≤ng M·ªõi
          </button>
          <div class="relative flex items-center">
            <hr class="w-full" />
            <span
              class="absolute left-1/2 -translate-x-1/2 bg-white px-2 text-gray-500"
              >ho·∫∑c</span
            >
            <hr />
          </div>
          <div class="flex gap-2">
            <input
              type="text"
              id="joinRoomInput"
              class="flex-grow border border-gray-300 rounded-lg p-3"
              placeholder="Nh·∫≠p ID ph√≤ng..."
            />
            <button
              id="joinGameButton"
              class="bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-5 rounded-lg"
            >
              V√†o
            </button>
          </div>
        </div>
        <button
          class="mt-8 w-full bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 rounded-lg transition back-to-menu-button"
        >
          Quay L·∫°i Menu
        </button>
      </div>

      <!-- Lobby View -->
      <div id="lobbyView" class="hidden">
        <h2 class="text-2xl font-bold text-gray-800 mb-2">Ph√≤ng Ch·ªù</h2>
        <div class="text-sm text-gray-600 mb-4">
          ID Ph√≤ng:
          <code
            id="lobbyRoomId"
            class="font-mono bg-gray-200 p-1 rounded cursor-pointer"
            title="Sao ch√©p ID"
          ></code>
        </div>
        <div class="space-y-1 mb-4">
          <label
            for="lobbyRoomLink"
            class="block text-sm font-medium text-gray-700"
            >Link ph√≤ng:</label
          >
          <div class="relative">
            <input
              type="text"
              id="lobbyRoomLink"
              readonly
              class="font-mono bg-gray-100 border-gray-300 border p-2 rounded-lg w-full cursor-pointer text-xs pr-10"
              title="Sao ch√©p link"
            />
            <button
              id="copyLinkButton"
              class="absolute inset-y-0 right-0 flex items-center pr-3"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                class="text-gray-500 hover:text-gray-800"
              >
                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                <path
                  d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"
                ></path>
              </svg>
            </button>
          </div>
        </div>
        <div
          id="lobbyHostControls"
          class="hidden space-y-3 mb-4 p-3 bg-gray-50 rounded-lg"
        >
          <h3 class="font-bold">C√†i ƒë·∫∑t (ch·ªß ph√≤ng)</h3>
          <div class="flex gap-2">
            <div class="flex-grow">
              <label for="lobbyMapSelect" class="block text-sm font-medium"
                >Ch·ªçn Map:</label
              >
              <select
                id="lobbyMapSelect"
                class="w-full border rounded p-2"
              ></select>
            </div>
            <button
              id="lobbyCustomMapButton"
              class="self-end bg-orange-500 hover:bg-orange-600 text-white font-bold py-2 px-3 rounded-lg"
              title="T·∫°o map t√πy ch·ªânh"
            >
              ‚öôÔ∏è
            </button>
          </div>
        </div>
        <div
          id="lobbyMapPreview"
          class="hidden my-4 p-3 bg-blue-50 rounded-lg border border-blue-200"
        >
          <h3 class="font-bold text-blue-800">Th√¥ng s·ªë Map ƒê∆∞·ª£c Ch·ªçn</h3>
          <p id="lobbyMapPreviewDetails" class="text-blue-700 mt-1"></p>
        </div>
        <div class="mb-4">
          <h3 class="font-bold text-lg mb-2">
            Ng∆∞·ªùi ch∆°i (<span id="lobbyPlayerCount">1</span>)
          </h3>
          <div id="lobbyPlayerList" class="space-y-2"></div>
        </div>
        <div
          id="lobbyGuestMessage"
          class="text-center text-gray-500 italic my-4"
        >
          Ch·ªù ch·ªß ph√≤ng b·∫Øt ƒë·∫ßu...
        </div>

        <!-- Lobby Chat -->
        <div id="lobbyChatContainer" class="mt-4">
          <h3 class="font-bold text-lg mb-2 text-gray-700">Chat Ph√≤ng</h3>
          <div
            id="lobbyChatMessages"
            class="h-32 overflow-y-auto border rounded p-2 bg-gray-50 mb-2 flex flex-col"
          ></div>
          <form id="lobbyChatForm" class="flex gap-2">
            <input
              type="text"
              id="lobbyChatInput"
              placeholder="Nh·∫≠p tin nh·∫Øn..."
              class="flex-grow border rounded p-2"
              autocomplete="off"
            />
            <button
              type="submit"
              class="bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-2 px-4 rounded-lg"
            >
              G·ª≠i
            </button>
          </form>
        </div>

        <button
          id="startGameButton"
          class="hidden w-full bg-green-500 hover:bg-green-600 text-white font-bold py-3 rounded-lg text-lg mt-4"
        >
          B·∫Øt ƒê·∫ßu
        </button>
        <button
          id="readyButton"
          class="hidden w-full bg-green-500 hover:bg-green-600 text-white font-bold py-3 rounded-lg text-lg mt-4"
        >
          S·∫µn S√†ng
        </button>
        <button
          id="leaveLobbyButton"
          class="mt-3 w-full bg-red-500 hover:bg-red-600 text-white font-bold py-2 rounded-lg"
        >
          R·ªùi Ph√≤ng
        </button>
      </div>
    </div>

    <!-- MODALS -->
    <div id="displayNameModal" class="modal-overlay">
      <div class="modal-content">
        <h2 class="text-2xl font-bold text-gray-800 mb-4">Ch√†o m·ª´ng b·∫°n!</h2>
        <p class="text-gray-600 mb-4">
          Vui l√≤ng nh·∫≠p t√™n hi·ªÉn th·ªã c·ªßa b·∫°n ƒë·ªÉ tham gia.
        </p>
        <form id="displayNameForm">
          <input
            type="text"
            id="displayNameInput"
            class="w-full border border-gray-300 rounded-lg p-2 focus:ring-2 focus:ring-blue-500"
            placeholder="T√™n c·ªßa b·∫°n..."
            required
            minlength="3"
            maxlength="20"
          />
          <button
            type="submit"
            id="submitDisplayNameButton"
            class="mt-4 w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg"
          >
            X√°c Nh·∫≠n
          </button>
        </form>
      </div>
    </div>
    <div id="guideModal" class="modal-overlay">
      <div class="modal-content">
        <button
          class="close-button"
          onclick="this.parentElement.parentElement.style.display='none'"
        >
          &times;
        </button>
        <h2 class="text-2xl font-bold text-gray-800 mb-4 border-b pb-2">
          üìö H∆∞·ªõng D·∫´n Ch∆°i
        </h2>
        <div class="text-gray-700 space-y-3">
          <p>M·ª•c ti√™u l√† m·ªü t·∫•t c·∫£ c√°c √¥ tr√™n b·∫£ng m√† kh√¥ng ch·∫°m ph·∫£i m√¨n.</p>
          <h3 class="font-semibold text-lg text-blue-600">Quy t·∫Øc c∆° b·∫£n:</h3>
          <ul class="list-disc list-inside ml-4 space-y-2 text-sm">
            <li><b>M·ªü √î (Nh·∫•n):</b> Nh·∫•n v√†o m·ªôt √¥ ƒë·ªÉ m·ªü n√≥.</li>
            <li>
              <b>C·∫Øm C·ªù (Nh·∫•n gi·ªØ/Chu·ªôt ph·∫£i):</b> ƒê√°nh d·∫•u √¥ b·∫°n nghƒ© l√† m√¨n.
            </li>
            <li>
              <b>S·ªë (1-8):</b> Cho bi·∫øt c√≥ bao nhi√™u qu·∫£ m√¨n trong 8 √¥ l√¢n c·∫≠n.
            </li>
            <li>
              <b>M·ªü Nhanh (Chord):</b> Nh·∫•n v√†o m·ªôt √¥ s·ªë ƒë√£ m·ªü khi b·∫°n ƒë√£ c·∫Øm ƒë·ªß
              s·ªë c·ªù t∆∞∆°ng ·ª©ng xung quanh n√≥.
            </li>
          </ul>
          <h3 class="font-semibold text-lg text-green-600 mt-4">Ph·ª• Tr·ª£:</h3>
          <ul class="list-disc list-inside ml-4 space-y-2 text-sm">
            <li><b>Tia X:</b> M·ªü m·ªôt √¥ ng·∫´u nhi√™n ch·∫Øc ch·∫Øn kh√¥ng c√≥ m√¨n.</li>
            <li>
              <b>C·ªù T·ª± ƒê·ªông:</b> T√¨m v√† c·∫Øm c·ªù v√†o m·ªôt √¥ ch·∫Øc ch·∫Øn l√† m√¨n.
            </li>
            <li><b>L∆∞·ªõt S√≥ng:</b> T·ª± ƒë·ªông "M·ªü Nhanh" m·ªôt √¥ h·ª£p l·ªá.</li>
            <li>
              <b>Khi√™n:</b> B·∫£o v·ªá b·∫°n kh·ªèi qu·∫£ m√¨n ƒë·∫ßu ti√™n b·∫°n nh·∫•n ph·∫£i.
            </li>
            <li><b>M√°y D√≤:</b> Qu√©t khu v·ª±c 3x3 ƒë·ªÉ ƒë·∫øm s·ªë m√¨n.</li>
          </ul>
        </div>
        <button
          onclick="this.parentElement.parentElement.style.display='none'"
          class="mt-6 w-full bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 rounded-lg transition"
        >
          ƒê√≥ng
        </button>
      </div>
    </div>
    <div id="commandModal" class="modal-overlay">
      <div class="modal-content">
        <h2 class="text-2xl font-bold text-gray-800 mb-4">Nh·∫≠p L·ªánh</h2>
        <form id="commandForm">
          <input
            type="text"
            id="commandInput"
            class="w-full border border-gray-300 rounded-lg p-2 focus:ring-2 focus:ring-blue-500"
            placeholder="/"
            autocomplete="off"
          />
          <div class="flex justify-end space-x-2 mt-4">
            <button
              type="button"
              id="closeCommandModalButton"
              class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded-lg"
            >
              H·ªßy
            </button>
            <button
              type="submit"
              id="submitCommandButton"
              class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg"
            >
              G·ª≠i
            </button>
          </div>
        </form>
      </div>
    </div>
    <div id="gameOverModal" class="modal-overlay">
      <div class="modal-content text-center">
        <button id="closeGameOverModal" class="close-button">&times;</button>
        <div id="gameOverIcon" class="text-7xl mb-4"></div>
        <h2 id="gameOverTitle" class="text-3xl font-extrabold mb-2"></h2>
        <p id="gameOverMessage" class="text-gray-600 mb-4"></p>
        <div
          id="gameOverBotResult"
          class="hidden p-3 bg-gray-100 rounded-lg mb-4"
        ></div>
        <div class="p-3 bg-gray-100 rounded-lg mb-6">
          <p class="text-sm text-gray-500">Th·ªùi gian ho√†n th√†nh</p>
          <p id="gameOverTime" class="text-4xl font-bold text-gray-800"></p>
        </div>
        <div id="gameOverControls" class="grid grid-cols-2 gap-3">
          <button
            id="gameOverResetButton"
            class="w-full bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-3 rounded-lg"
          >
            Ch∆°i L·∫°i
          </button>
          <button
            id="gameOverMenuButton"
            class="w-full bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 rounded-lg"
          >
            V·ªÅ Menu
          </button>
        </div>
      </div>
    </div>
    <div id="mineHitModal" class="modal-overlay">
      <div class="modal-content text-center">
        <div class="text-7xl mb-4">üí•</div>
        <h2 class="text-3xl font-extrabold mb-2 text-red-500">D√≠nh M√¨n!</h2>
        <p class="text-gray-600 mb-6">
          Th·ªùi gian c·ªßa b·∫°n v·∫´n ƒëang ch·∫°y. H√£y th·ª≠ l·∫°i m√†n n√†y!
        </p>
        <button
          id="retryBoardButton"
          class="w-full bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-3 rounded-lg"
        >
          Th·ª≠ L·∫°i
        </button>
      </div>
    </div>
    <div id="leaderboardModal" class="modal-overlay">
      <div class="modal-content">
        <button
          class="close-button"
          onclick="this.parentElement.parentElement.style.display='none'"
        >
          &times;
        </button>
        <h2 class="text-2xl font-bold text-gray-800 mb-4 border-b pb-2">
          üèÜ B·∫£ng X·∫øp H·∫°ng
        </h2>
        <div class="mb-4">
          <label
            for="leaderboardMapSelect"
            class="block text-sm font-medium text-gray-700"
            >Ch·ªçn c·∫•p ƒë·ªô:</label
          >
          <select
            id="leaderboardMapSelect"
            class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md"
          ></select>
        </div>
        <div id="leaderboardModalContent" class="space-y-2"></div>
        <button
          onclick="this.parentElement.parentElement.style.display='none'"
          class="mt-6 w-full bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 rounded-lg transition"
        >
          ƒê√≥ng
        </button>
      </div>
    </div>
    <div id="historyModal" class="modal-overlay">
      <div class="modal-content">
        <button
          class="close-button"
          onclick="this.parentElement.parentElement.style.display='none'"
        >
          &times;
        </button>
        <h2 class="text-2xl font-bold text-gray-800 mb-4 border-b pb-2">
          üìú L·ªãch S·ª≠ ƒê·∫•u
        </h2>
        <div id="historyModalContent" class="space-y-2"></div>
        <button
          onclick="this.parentElement.parentElement.style.display='none'"
          class="mt-6 w-full bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 rounded-lg transition"
        >
          ƒê√≥ng
        </button>
      </div>
    </div>
    <div
      id="toast-container"
      class="fixed top-5 right-5 z-[9999] space-y-2"
    ></div>
    <script type="module" src="script.js"></script>
  </body>
</html>
